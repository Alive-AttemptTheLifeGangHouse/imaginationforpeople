{% extends "project_sheet/project_base.html" %}

{% load i18n %}
{% load tagging_tags %}

{% block extra_head %}
  {{ block.super }}
	<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}/css/jquery/jquery.ui.autocomplete.tagit.css" media="screen, projection" />
	<link rel="stylesheet" href="{{ MEDIA_URL }}/css/anythingslider.css" type="text/css" media="screen" />

	<!-- inline  -->
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.jeditable.js"></script>

	<!-- for tags -->
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.tag-it.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.tag-it.iecompat.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.tinysort.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.tagcloud.js"></script>

	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.ba-serializeobject.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery/jquery.dajax.core.js"></script>
	<script type="text/javascript" src="/js/dajax/dajaxice.core.js"></script>

	<!-- Scripts for Image Slider & Miniatures -->
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery.easing.1.2.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery.anythingslider.js" ></script>
	
	<script type="text/javascript" src="{{ MEDIA_URL }}/js/jquery.jcarousel.min.js"></script>

	<!-- Scripts for Miniatures -->
	<script type="text/javascript">

		jQuery(document).ready(function() {
			$('#project_photo_gallery_mini').jcarousel();
		});

		
	</script>


	<!-- Scripts for Image Slider -->
	<script type="text/javascript">

		$(function () {

			$('#project_photo_gallery_current_photo').anythingSlider({
				width : 700,          // Override the default CSS width
				height: 460,		// Override the default CSS height
				delay               : 10000,      // How long between slideshow transitions in AutoPlay mode (in milliseconds)
				animationTime       : 600,       // How long the slideshow transition takes (in milliseconds)
				buildArrows         : false,      // If true, builds the forwards and backwards buttons
				resizeContents      : true,      // If true, solitary images/objects in the panel will expand to fit the viewport
				autoPlay            : true,     // This turns off the entire slideshow FUNCTIONALY, not just if it starts running or not

				easing: 'easeInOutExpo'
			});	

		});
		
		function changeslider(sid){
				$('#project_photo_gallery_current_photo').anythingSlider(sid);
				return false;
		};

	</script>


  <script type="text/javascript">
    $(document).ready(function() {
	var tags = $("#themes_tags").tagit({
	    itemName: 'themes',
	});

	$("#themes_list").tagcloud({type:"sphere", sizemin:10, height: 200, colormin: "888888", colormax: "343434"}).find("li").tsort();

	$("#themes_list li").click(function($this) {
	    $.fn.tagit.create_tag($(this).text());
	});

	// restore tags in get
        {% if project_instance %}
          {% tags_for_object project_instance as project_tags %}
        	{% for tag in project_tags %}
	     $.fn.tagit.create_tag("{{ tag }}");
	  {% endfor %}
        {% endif %}

    });
  </script>


  <script type="text/javascript">
    function on_project_themes_updated(data) {
            if ( data!= Dajaxice.EXCEPTION ) {
                  alert(data.message);
            } else { alert('error'); }
//	    res = Dajax.process(data);

	//	$('#search-results').fadeTo('fast', 1);
	//	$('#search-results-wrapper').activity(false);
	//	$('#search').unblock();
    }

    function project_update_related() {
        //$('#search').block({message: 'Recherche en cours, patientez svp...'});
	//$('#search-results').fadeTo('fast', 0.3);
	//$('#search-results-wrapper').activity({width: 6, valign: 'center', padding: '20'});

	themes_form = $('#themes-form').serialize(); // serializeObject(true);

        Dajaxice.apps.project_sheet.project_update_related(Dajax.process, {'related_form': themes_form,
                                                                          'project_slug': '{{ project_instance.slug }}'}
        );

        $('#opened-sidebar').slideToggle();
        location.reload();
                                                          
	return false;
    }


  </script>

  <script type="text/javascript">
    $(document).ready(function() {
     function edit_callback(value, settings) {
       var fieldname = $(this).prev('div').attr('id');

       Dajaxice.apps.project_sheet.project_sheet_edit_field(Dajax.process, {'fieldname': fieldname, 
                                                                            'value': value
                                                                            {% if project_instance %}, 'project_slug': '{{ project_instance.slug }}' {% endif %} 
       });

       $(this).removeClass('empty');


       $(this).hide().fadeIn()
       restore_edit_buttons();

       return(value);
     };

     function restore_edit_buttons() {
       $('.project_details_title_edit .button').fadeIn('slow');
     }

     $('.project_details_body').editable(edit_callback,
                                         {event: 'dblclick',
                                          tooltip: 'Double-click to edit',
                                          indicator: 'Saving...',
                                          type: 'textarea',
                                          height: '80px',
                                          width: '690px',
                                          cancel: "<input class='redbutton right nomargin' style='margin-left:4px;' type='image' src='{{ MEDIA_URL }}/images/base/x.png' alt='X'/>",
                                          submit: "<input class='greenbutton right nomargin' style='margin-left:4px;' type='image' src='{{ MEDIA_URL }}/images/base/v.png' alt='Ok'/>",
                                          onblur: 'ignore',
                                          onreset: restore_edit_buttons,
                                          cssclass: 'inline-edit',
                                          placeholder: "{% trans "This bloc is empty : don’t forget to fill it ! A good project is a complete project !"|capfirst %}"
                                          });

    $('.project_details_body').dblclick(function() {
      $('.project_details_title_edit .button').fadeOut('fast');
    });

    $('.project_details_title_edit .button').click(function() {
      $(this).parent().next('.project_details_body').dblclick();
       return false;
    });
    
    });
  </script>


  <script type="text/javascript">
    $(document).ready(function() {
      $('#opened-sidebar').hide();
      

      $('a.sidebar-opener').click(function() {
         $('#opened-sidebar').slideToggle();
         return false;
      });

      $('a.sidebar-close').click(function() {
         $('#opened-sidebar').slideToggle();
         return false;
      });

    });
  </script>

{% endblock %}

{% block project_content %}	
  <div class="grid_13 alpha project_content">

    <!-- PROJECT TITLE -->
    {% if title_form %}
      <!-- PROJECT TITLE - edition mode-->
      {% if project_instance %}
	<form id="title" action="{% url  project_sheet-instance-edit-field project_instance.slug 'title' %}" method="post">{% csrf_token %}
      {% else %}
	<form id="title" action="{% url project_sheet-edit-field 'title' %}" method="post">{% csrf_token %}
      {% endif %}
      {{title_form.title}}
      <input id="project_title_submit" type="submit" value="&nbsp;" />
	</form>

      {% else %}
	{% if project_instance %}
	  <!-- PROJECT TITLE - filled -->
	  <a href="{% url project_sheet-instance-edit-field project_instance.slug 'title' %}">
	    <div id="project_title">{{ project_instance.title }}</div>
	  </a>
	{% else %}
	  <!-- PROJECT TITLE - empty -->
	  <a href="{% url project_sheet-edit-field 'title' %}">
	    <div id="project_title_edit_inactive">{% trans 'my project title'|capfirst %}</div>
	  </a>
	{% endif %}
      {% endif %}
      

      <!-- BASELINE -->
      {% if baseline_form %}
	<!-- BASELINE - edition mode-->
	{% if project_instance %}
	  <form id="baseline" action="{% url project_sheet-instance-edit-field project_instance.slug 'baseline' %}" method="post" class="project_baseline_edition">{% csrf_token %}
	{% else %}
	  <form id="baseline" action="{% url project_sheet-edit-field 'baseline'%}" method="post" class="project_baseline_edition">{% csrf_token %}
	{% endif %}
	{{ baseline_form.baseline }}
	<input class="greenbutton" type="image"  src="{{ MEDIA_URL }}/images/base/v.png" alt="Ok" />
	<input class="redbutton" type="image" src="{{ MEDIA_URL }}/images/base/x.png" alt="X" />	
	</form>	
	{% else %}
	  {% if project_instance %}
	    <!-- BASELINE - filled-->
	    <div class="project_baseline focus">
	      <p>{{ project_instance.baseline }}</p>
	      <a href="{% url project_sheet-instance-edit-field project_instance.slug 'baseline' %}" class="button right"><img src="{{ MEDIA_URL }}/images/base/edit.png" /></a>
	    </div>
	  {% else %}
	    <!--  BASELINE - empty -->
	    <div class="project_baseline_edition_inactive">
	      <p>{% trans "my project baseline"|capfirst %}</p>
	      <a href="{% url project_sheet-edit-field 'baseline' %}" class="button"><img src="{{ MEDIA_URL }}/images/base/edit.png" alt="edit" /></a>
	    </div>
	  {% endif %}
	{% endif %}					
	
	<!-- PROJECT INFOS -->
	<div class="project_infos_bloc">
	  {% if project_instance %} 
	    <div class="creation_date">{{ project_instance.created }} {% trans 'by' %} 
	    <i>
	      {% if project_instance.author %}
		{{ project_instance.author.get_full_name_or_username }}
	      {% else %}
		{% trans 'anonymous'|capfirst %}
	      {% endif %}
	    </i>
	    ({{project_instance.ip_addr }})
	    </div>
	    <!--
		<div class="location">{{ project_instance.location }}</div>
	    -->
	  {% endif %}
	</div>
	
	{% include "media_gallery.html"%}
	
	<!-- PROJECT DESCRIPTION -->
	<div class="project_description">
	  {% include "about_section.html" %}
	</div>					
	

	<!-- PROJECT DETAILS -->
	<div class="project_details">
	  {% include "uniqueness_section.html" %}
	  
	  {% include "value_section.html" %}
	  
	  {% include "scalability_section.html" %}
	  
	</div>
	
	
      </div>
      
      <!-- GREY COLUMN - closed (default) -->
      <div class="grid_5 omega grey_column">											
	<div class="grey_column_content">					
	  
	  {% if project_instance.themes %}
	    <div class="title">
	      <a href="{% url project_sheet-instance-edit-related project_instance.slug %}" class="button sidebar-opener"><img src="{{ MEDIA_URL }}/images/base/edit.png" alt="edit" /></a>{% trans 'Related'|capfirst %}
	    </div>

	    <!-- Colonne grise remplie -->
	    <div class="grey_column_objective">	
	      <label>{% trans 'Objective :'|capfirst %}</label> 
	      <a href="#" id="project_objective">{{ project_instance.get_objective_display }}</a>
	    </div>


	    {% tags_for_object project_instance as taglist %}
	    <div class="grey_column_tagcloud">	
	      <label>{% trans 'Themes:'|capfirst %}</label> 							
	      <ul id="cloudtag_list">
		{% for tag in taglist %}
		  <li><a href="#">{{ tag }}</a>{% if not forloop.last %},{% endif %}</li>
		{% endfor %}
	      </ul>
	    </div>
	    
	  {% else %}
	  
	  <!-- GREY COLUMN - empty -->
	  <h1>{% trans "What's the project's objective ?"|capfirst %}</h1>
	  <p>
	    <a class="sidebar-opener" href="#">{% trans "Click here to set the <strong>objective</strong> and the <strong>themes</strong> of your project."|capfirst %}</a>
	  </p>

	  {% endif %}
	    
	</div>					
      </div>	

      <!-- GREY COLUMN - opened -->
      <div id="opened-sidebar" class="grid_12 omega grey_column_open">	
	<div class="grey_column_content">	
	  
	  <div class="title">{% trans 'Related'|capfirst %}</div>

	  <form id="themes-form" method="POST">

	  <div class="grey_column_content_edition">
	    
	    <div class="grey_column_objective_edition">						
	      <form action="#" method="#">
		<p>
		  <label>{% trans 'Objective :'|capfirst %}</label> 
		  {{ project_related_form.objective }}
		</p>
	      </form>						
	    </div>						
	    
	    <div class="grey_column_cloudtag_edition">
	      
		<div id="grey_column_cloudtag_edition_title">
		  <label>{% trans 'Themes:'|capfirst %}</label><span class="precision">({% trans 'select your tags from the cloud below' %})</span>
		</div>
		
		<ul id="themes_list">
		  {% tags_for_model project_sheet.I4pProject as project_sheet_tags with counts %}
		    
		    {% for tag in project_sheet_tags %}
		      <li value="{{ tag.count }}"><a href="javascript:;">{{ tag }}</a></li>
		    {% endfor %}
		</ul>
		
		<ul id="themes_tags">
		</ul>

	    </div>

		<a id="grey_column_close" class="sidebar-close" href="javascript:;">{% trans 'Close & discard'%}</a>
	    <a href="javascript:;" onclick="javascript: return project_update_related();" id="grey_column_save_close">{% trans 'Save & close'%}</a>

	  </form>
	</div>						
	  
      </div>					
    </div>					

{% endblock %}