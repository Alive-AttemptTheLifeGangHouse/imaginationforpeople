{% extends "workgroup/layout/workgroup_base.html" %}

{% load i18n %}
{% load wiki_tags %}
{% load tagging_tags %}
{% load comments %}
{% load admin_urls %}
{% load guardian_tags %}
{% load thumbnail %}
{% load sekizai_tags %}

{% addtoblock "css" %}
<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}css/workgroup/block/workgroup_detail.css" />
{% endaddtoblock %}

{% block content %}

    <div class="container" id="workgroup-detail">
      {% if workgroup.picture %}
      <img src="{% thumbnail workgroup.picture 960x300 crop %}"/>
      {% endif %}

      <div id="workgroup-infos" class="row">
        <div class="span8">
          {% include "workgroup/block/workgroup_subscribers.html" %}
          {% include "workgroup/block/subscribe_button.html" %}

          <div id="workgroup-card">
            <h1 class="workgroup_title"><a href="/workgroup">{{ workgroup.name }}</h1>
            {% if request.user.is_staff %}
            <a href="{% url admin:workgroup_workgroup_change workgroup.pk  %}">{% trans "Manage in admin" %}</a>
            {% endif %}
            {% get_obj_perms request.user for workgroup as "workgroup_perms" %}
            {% if "change_workgroup" in workgroup_perms %}
            <a href="{% url workgroup-edit workgroup.slug %}">{% trans "Edit" %}</a>
            {% endif %}
            <span class="workgroup_desc">{{ workgroup.description|safe|urlize }}</span>
            {{ wiki_article.render }}
            [<a href="{% url workgroup-wiki-edit workgroup.slug %}">edit</a>]
          </div>
        </div>
        <div class="span4">
          <div class="workgroup-lang">
              {% trans "Spoken language :" %} {{ workgroup.get_language_display }}
          </div>
          <div class="members">
            <strong><span>{{ workgroup.subscribers.all|length}}</span> 
	      {% blocktrans with workgroup.subscribers.all|length|pluralize as member_plural %}
	      member{{ member_plural }}
	      {%endblocktrans%}

	    </strong>
            <a href="#">{% trans "See all" %}</a>
          </div>
        </div>
      </div>

      <div id="workgroup-content" class="row">
        <div class="span8">
          {% tags_for_object workgroup as group_tags %}
          {% include 'tags/block/taglist.html' with taglist_tags=group_tags taglist_title='themes' %}

          {% if workgroup.mailing_list %}
             <em class="workgroup_email">To send an e-mail to the list, use the following address: {{ workgroup.mailing_list.email }}</em><a class="workgroup_archive" href="{{ workgroup.mailing_list.main_url }}/../../../pipermail/{{ workgroup.mailing_list.name }}"> - [Browse the Archives]</a>

            {% else %}
            {% if workgroup.outside_url %}
            <a href="{{ workgroup.outside_url }}">LINK TO THE GROUP, IN THE WORLD WILD WEB</a>
            {% endif %}
          {% endif %}

          {% get_comment_count for workgroup as comment_count %}
          <h3>Shoutbox ({{ comment_count }})</h3> 
          {% if comment_count %}
          {% render_comment_list for workgroup %}
          {% endif %}
          {% get_comment_form for workgroup as comment_form %}
          <form method='POST' action='{% comment_form_target %}'>
            {% csrf_token %}
            {{ comment_form }}
            <input type="submit" name="submit" value="Post">
          </form>
        </div>
        <div class="span4">
          <h3>Group projects</h3>
          {% include 'project_sheet/block/cardlist_fancy_wide.html' with project_translation_list=group_projects %}
        </div>
      </div>
    </div>
    
{% endblock %}


