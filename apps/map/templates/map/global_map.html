{%extends "base.html" %}
{% load leaflet_tags %}
{% load i18n %}

{% block meta_desc %}{% trans 'These experiences have a positive social impact and create social goodwill. they demonstrate a disruptive inventiveness and can be easily disseminated and scaled in other places or cultural contexts.'%}{% endblock %}
{% block title %}{% trans 'Map of projects'%}{% endblock %}

{% block extra_head %}
{% leaflet_js  plugins="markercluster" %}
{% leaflet_css plugins="markercluster"%}

<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}css/project_sheet/block/project_card.css" />

<style>

    #projectsMap {
        height: 600px;
    }

</style>
{% endblock %}
 
{% block content %}
{% leaflet_map "projectsMap" %}
<script src="{{STATIC_URL}}projects.geojson"></script>
<script type="text/javascript">

    function projectsMapInit(map, bounds) {
    	$("#beta-logo").hide();
    	
    	var markers = new L.MarkerClusterGroup();

		var geoJsonLayer = L.geoJson(geoJsonData, {
			onEachFeature: function (feature, layer) {
				layer.on('mouseover', function(e) {
					layer.unbindPopup();
					$.get("{% url get-project-card %}", { project_id: feature.id }, function (data){
						layer.bindPopup(data);
					});
				});
			}
		});
		markers.addLayer(geoJsonLayer);

		map.addLayer(markers);
		map.fitBounds(markers.getBounds());
    }
</script>
{% endblock %}